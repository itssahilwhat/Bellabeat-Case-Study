---
title: "Bellabeat Data Analysis"
output: html_document
---

## Characters and Products

### Characters
- **Urška Sršen**: Bellabeat’s cofounder and Chief Creative Officer
- **Sando Mur**: Mathematician and Bellabeat’s cofounder; key member of the Bellabeat executive team
- **Bellabeat marketing analytics team**: A team of data analysts responsible for collecting, analyzing, and reporting data that helps guide Bellabeat’s marketing strategy. You joined this team six months ago and have been busy learning about Bellabeat’s mission and business goals — as well as how you, as a junior data analyst, can help Bellabeat achieve them.

### Products
- **Bellabeat app**: The Bellabeat app provides users with health data related to their activity, sleep, stress, menstrual cycle, and mindfulness habits. This data can help users better understand their current habits and make healthy decisions. The Bellabeat app connects to their line of smart wellness products.
- **Leaf**: Bellabeat’s classic wellness tracker that can be worn as a bracelet, necklace, or clip. The Leaf tracker connects to the Bellabeat app to track activity, sleep, and stress.
- **Time**: This wellness watch combines the timeless look of a classic timepiece with smart technology to track user activity, sleep, and stress. The Time watch connects to the Bellabeat app to provide users with insights into their daily wellness.
- **Spring**: This is a water bottle that tracks daily water intake using smart technology to ensure that users stay hydrated throughout the day. The Spring bottle connects to the Bellabeat app to track hydration levels.
- **Bellabeat membership**: Bellabeat offers a subscription-based membership program for users. Membership gives users 24/7 access to fully personalized guidance on nutrition, activity, sleep, health, beauty, and mindfulness based on their lifestyle and goals.

## Step 1: Ask

Sršen asks you to analyze smart device usage data to gain insight into how consumers use non-Bellabeat smart devices. She then wants you to select one Bellabeat product to apply these insights to in your presentation. These questions will guide your analysis:

1. What are some trends in smart device usage?
2. Who are the main stakeholders?
3. How could these trends apply to Bellabeat customers?
4. How could these trends help influence Bellabeat's marketing strategy?

### Deliverables
You will produce a repo with the following deliverables:

1. A clear summary of the business task
2. A description of all data sources used
3. Documentation of any cleaning or manipulation of data
4. A summary of your analysis
5. Supporting visualizations and key findings
6. Your top high-level content recommendations based on your analysis

### Things to Consider
- Define the problem you’re trying to solve
- Make sure you fully understand the stakeholder’s expectations
- Focus on the actual problem and avoid any distractions
- Collaborate with stakeholders and keep an open line of communication
- Take a step back and see the whole situation in context

### Questions to Ask Yourself in This Step:
- What are my stakeholders saying their problems are?
- Now that I’ve identified the issues, how can I help the stakeholders resolve their questions?

## Key Tasks
1. Identify the business task
2. Consider key stakeholders

## Deliverable
A clear statement of the business task

## Step 2: Prepare

Sršen encourages you to use public data that explores smart device users’ daily habits. She points you to a specific dataset:

- [**FitBit Fitness Tracker Data**](https://www.kaggle.com/datasets/arashnic/fitbit) (CC0: Public Domain, dataset made available through Mobius): This Kaggle dataset contains personal fitness tracker data from Fitbit users. These eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. It includes information about daily activity, steps, and heart rate that can be used to explore users’ habits.

Sršen tells you that this dataset might have some limitations and encourages you to consider adding another dataset to help address those limitations as you begin to work more with this data.


#### Guiding Questions
1. **Where is your data stored?**
    The data is stored on Kaggle, a popular platform for sharing datasets. Specifically, it can be found on the [Fitbit Fitness Tracker Data](https://www.kaggle.com/datasets/arashnic/fitbit) page. You can download the dataset directly from Kaggle to your local machine or cloud storage, depending on where you are working.

2. **How is the data organized? Is it in long or wide format?**
    The dataset is likely organized in **wide format**, where each column represents a specific feature (e.g., `steps`, `heart_rate`, `activity_level`) and each row represents a time series data entry (such as a day's worth of data for a user). In general, Fitbit datasets from platforms like this are stored in this format to make it easy to analyze time-based data for individual users or groups of users.

3. **Are there issues with bias or credibility in this data? Does your data ROCCC?**
   - **Bias:** Since the data is from Fitbit users who opted to share their information, it could be biased toward people who are already health-conscious or who are more active. The dataset may not represent the general population, which could affect the generalizability of any insights derived.
   - **Credibility:** The data comes from a reputable source (Fitbit users who consented to share their data), which enhances its credibility. However, users might not always use the device consistently or might have different interpretations of tracking features.
   - **ROCCC (Reliable, Original, Complete, Current, and Cited):** This dataset is **reliable** (from Fitbit), **original** (personal data collected through Fitbits), **complete** (contains various metrics for activity, sleep, heart rate), **current** (as of when it was last uploaded), and **cited** (available on Kaggle with proper attribution).

4. **How are you addressing licensing, privacy, security, and accessibility?**
   - **Licensing:** The dataset is available under the **CC0: Public Domain** license, which means it can be freely used without restrictions.
   - **Privacy:** The dataset does not contain personally identifiable information, as users have consented to provide fitness and activity data anonymously. It's essential to ensure that privacy concerns are addressed by not sharing any personal or sensitive data.
   - **Security:** The data itself does not present security risks, but you should store the dataset in a secure location (local machine or cloud with appropriate encryption).
   - **Accessibility:** The dataset is publicly accessible on Kaggle, and users can download it with a Kaggle account. It's essential to ensure that any findings and analyses are shared in an accessible way for stakeholders and team members.

5. **How did you verify the data’s integrity?**
    The dataset's integrity can be verified by:
        - **Checking the source**: Confirming that the data comes from a reliable platform like Kaggle and is maintained by a reputable user or organization.
        - **Ensuring data consistency**: Analyzing if there are missing values, duplicates, or any obvious errors in the data entries (e.g., negative step counts, impossible heart rate values).
        - **Cross-referencing with other sources**: If needed, you can verify some of the patterns or values by comparing them with other publicly available Fitbit datasets or reports to ensure consistency.

6. **How does it help you answer your question?**
    This dataset is directly relevant to answering your business task since it provides detailed data on **user activity**, **sleep patterns**, and **heart rate**, which are crucial aspects of wellness tracked by Fitbit devices. By analyzing this data, you can identify trends in smart device usage, particularly focusing on the behavior of users related to their health and wellness. These insights can then be applied to Bellabeat’s products like the Leaf, Time, and Spring, helping to inform marketing strategies and product development.

7. **Are there any problems with the data?**
    Possible issues with the data might include:
        - **Incomplete or missing data**: Users might not have fully utilized their devices or might have data gaps.
        - **Inconsistent usage**: Users may not consistently wear or use their devices, leading to uneven data for certain days.
        - **Limited data on non-Bellabeat users**: Since this data only involves Fitbit users, it does not capture insights from people using other types of smart devices, which might limit the generalizability of the findings for Bellabeat’s diverse customer base.

#### Key Tasks
1. **Download data and store it appropriately.**
2. **Identify how it’s organized.**
3. **Sort and filter the data.**
4. **Determine the credibility of the data.**


#### Install Packages
```{r}
install.packages("tidyverse")
install.packages("lubridate")
install.packages("dplyr")
install.packages("ggplot2")
install.packages("tidyr")
install.packages("here")
install.packages("skimr")
install.packages("janitor")
```

#### Load Libraries
```{r}
library(tidyverse)
library(lubridate)
library(dplyr)
library(ggplot2)
library(tidyr)
library(here)
library(skimr)
library(janitor)
```




```{r}
daily_activity <- read_csv("Datasets/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
daily_calories <- read_csv("Datasets/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/dailyCalories_merged.csv")
daily_intensities <- read_csv("Datasets/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/dailyIntensities_merged.csv")
daily_steps <- read_csv("Datasets/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/dailySteps_merged.csv")
heartrate <- read_csv("Datasets/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/heartrate_seconds_merged.csv")
weight_log <- read_csv("Datasets/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/weightLogInfo_merged.csv")
sleep <- read_csv("Datasets/mturkfitbit_export_4.12.16-5.12.16/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
```

```{r}
head(daily_activity)
colnames(daily_activity)
str(daily_activity)
glimpse(daily_activity)
```

```{r}
head(daily_calories)
colnames(daily_calories)
str(daily_calories)
glimpse(daily_calories)
```

```{r}
head(daily_intensities)
colnames(daily_intensities)
str(daily_intensities)
glimpse(daily_intensities)
```


```{r}
head(daily_steps)
colnames(daily_steps)
str(daily_steps)
glimpse(daily_steps)
```


```{r}
head(heartrate)
colnames(heartrate)
str(heartrate)
glimpse(heartrate)
```

```{r}
head(weight_log)
colnames(weight_log)
str(weight_log)
glimpse(weight_log)
```

```{r}
head(sleep)
colnames(sleep)
str(sleep)
glimpse(sleep)
```


## Step 3: Process

### Guiding Questions
- What tools are you choosing and why?
- Have you ensured your data’s integrity?
- What steps have you taken to ensure that your data is clean?
- How can you verify that your data is clean and ready to analyze?
- Have you documented your cleaning process so you can review and share those results?

### Key Tasks
1. Check the data for errors.
2. Choose your tools.
3. Transform the data so you can work with it effectively.
4. Document the cleaning process.

### Deliverable
Documentation of any cleaning or manipulation of data.

---

### Data Cleaning Process
```{r}
# Total missing values
cat("Missing values in daily_activity:", sum(is.na(daily_activity)), "\n")
cat("Missing values in daily_calories:", sum(is.na(daily_calories)), "\n")
cat("Missing values in daily_intensities:", sum(is.na(daily_intensities)), "\n")
cat("Missing values in daily_steps:", sum(is.na(daily_steps)), "\n")
cat("Missing values in heartrate:", sum(is.na(heartrate)), "\n")
cat("Missing values in weight_log:", sum(is.na(weight_log)), "\n")
cat("Missing values in sleep:", sum(is.na(sleep)), "\n")
```

```{r}
# Check for empty rows
cat("Empty rows in daily_activity:", sum(rowSums(is.na(daily_activity)) == ncol(daily_activity)), "\n")
cat("Empty rows in daily_calories:", sum(rowSums(is.na(daily_calories)) == ncol(daily_calories)), "\n")
cat("Empty rows in daily_intensities:", sum(rowSums(is.na(daily_intensities)) == ncol(daily_intensities)), "\n")
cat("Empty rows in daily_steps:", sum(rowSums(is.na(daily_steps)) == ncol(daily_steps)), "\n")
cat("Empty rows in heartrate:", sum(rowSums(is.na(heartrate)) == ncol(heartrate)), "\n")
cat("Empty rows in weight_log:", sum(rowSums(is.na(weight_log)) == ncol(weight_log)), "\n")
cat("Empty rows in sleep:", sum(rowSums(is.na(sleep)) == ncol(sleep)), "\n")

# Check for empty columns
cat("Empty columns in daily_activity:", sum(colSums(is.na(daily_activity)) == nrow(daily_activity)), "\n")
cat("Empty columns in daily_calories:", sum(colSums(is.na(daily_calories)) == nrow(daily_calories)), "\n")
cat("Empty columns in daily_intensities:", sum(colSums(is.na(daily_intensities)) == nrow(daily_intensities)), "\n")
cat("Empty columns in daily_steps:", sum(colSums(is.na(daily_steps)) == nrow(daily_steps)), "\n")
cat("Empty columns in heartrate:", sum(colSums(is.na(heartrate)) == nrow(heartrate)), "\n")
cat("Empty columns in weight_log:", sum(colSums(is.na(weight_log)) == nrow(weight_log)), "\n")
cat("Empty columns in sleep:", sum(colSums(is.na(sleep)) == nrow(sleep)), "\n")
```




```{r}
# Calculate the proportion of missing values in each column
# missing_proportion <- colSums(is.na(weight_log)) / nrow(weight_log)
#
# # Drop columns where the proportion of missing values is greater than 50%
# weight_log <- weight_log[, missing_proportion <= 0.5]
```


```{r}
# Check for duplicates
cat("Number of duplicate rows in daily_activity before removal:", nrow(daily_activity[duplicated(daily_activity), ]), "\n")
cat("Number of duplicate rows in daily_calories before removal:", nrow(daily_calories[duplicated(daily_calories), ]), "\n")
cat("Number of duplicate rows in daily_intensities before removal:", nrow(daily_intensities[duplicated(daily_intensities), ]), "\n")
cat("Number of duplicate rows in daily_steps before removal:", nrow(daily_steps[duplicated(daily_steps), ]), "\n")
cat("Number of duplicate rows in heartrate before removal:", nrow(heartrate[duplicated(heartrate), ]), "\n")
cat("Number of duplicate rows in weight_log before removal:", nrow(weight_log[duplicated(weight_log), ]), "\n")
cat("Number of duplicate rows in sleep before removal:", nrow(sleep[duplicated(sleep), ]), "\n")

# Remove duplicates
daily_activity <- daily_activity[!duplicated(daily_activity), ]
daily_calories <- daily_calories[!duplicated(daily_calories), ]
daily_intensities <- daily_intensities[!duplicated(daily_intensities), ]
daily_steps <- daily_steps[!duplicated(daily_steps), ]
heartrate <- heartrate[!duplicated(heartrate), ]
weight_log <- weight_log[!duplicated(weight_log), ]
sleep <- sleep[!duplicated(sleep), ]

# Confirm duplicates removed
cat("Number of duplicate rows in sleep after removal:", nrow(sleep[duplicated(sleep), ]), "\n")
```

```{r}
# Convert character columns to date
daily_activity$ActivityDate <- as.Date(daily_activity$ActivityDate, format = "%m/%d/%Y")
daily_calories$ActivityDay <- as.Date(daily_calories$ActivityDay, format = "%m/%d/%Y")
daily_intensities$ActivityDay <- as.Date(daily_intensities$ActivityDay, format = "%m/%d/%Y")
daily_steps$ActivityDay <- as.Date(daily_steps$ActivityDay, format = "%m/%d/%Y")
heartrate$Time <- as.Date(heartrate$Time, format = "%m/%d/%Y")
weight_log$Date <- as.Date(weight_log$Date, format = "%m/%d/%Y")
sleep$SleepDay <- as.Date(sleep$SleepDay, format = "%m/%d/%Y")
```


```{r}
# Cleaning column names
daily_activity <- daily_activity %>% clean_names()
daily_calories <- daily_calories %>% clean_names()
daily_intensities <- daily_intensities %>% clean_names()
daily_steps <- daily_steps %>% clean_names()
heartrate <- heartrate %>% clean_names()
weight_log <- weight_log %>% clean_names()
sleep <- sleep %>% clean_names()
```

```{r}
# View updated column names
colnames(daily_activity)
colnames(daily_calories)
colnames(daily_intensities)
colnames(daily_steps)
colnames(heartrate)
colnames(sleep)
```

```{r}
# Summarize key metrics
daily_activity %>%
  summarise(participants = n_distinct(id))
daily_calories %>%
  summarise(participants = n_distinct(id))
daily_intensities %>%
  summarise(participants = n_distinct(id))
daily_steps %>%
    summarise(participants = n_distinct(id))
heartrate %>%
  summarise(participants = n_distinct(id))
weight_log %>%
  summarise(participants = n_distinct(id))
sleep %>%
  summarise(participants = n_distinct(id))
```


```{r}
# Key descriptive statistics
daily_activity %>%
select(total_steps, total_distance, sedentary_minutes, calories) %>%
summary()
daily_intensities %>%
select(very_active_minutes, lightly_active_minutes, fairly_active_minutes, sedentary_minutes) %>%
summary()
daily_calories %>%
select(calories) %>%
summary()
sleep %>%
select(total_sleep_records, total_minutes_asleep, total_time_in_bed) %>%
summary()
weight_log %>%
select(weight_kg, bmi) %>%
summary()
```


```{r}
colnames(daily_steps)
```


### Key findings from this analysis :

- The average sedentary time is too high (more than 16 hours). And definitely needs to be reduced with a good marketing strategy.
- The majority of the participants are lightly active. With a high sedentary time.
- Participants sleep 1 time for an average of 7 hours.
- Average total steps per day (which is 7638) is a little bit less than recommended by the CDC. According to the CDC research, taking 8,000 steps per day was associated with a 51% lower risk for all-cause mortality (or death from all causes). And taking 12,000 steps per day was associated with a 65% lower risk compared with taking 4,000 steps.

## Step-4 Analyze

Now that your data is stored appropriately and has been prepared for analysis, start putting it to work. Use the following Case Study Roadmap as a guide:

### Guiding Questions
- How should you organize your data to perform analysis on it?
- Has your data been properly formatted?
- What surprises did you discover in the data?
- What trends or relationships did you find in the data?
- How will these insights help answer your business questions?

### Key Tasks
1. Aggregate your data so it’s useful and accessible.
2. Organize and format your data.
3. Perform calculations.
4. Identify trends and relationships.

### Deliverable
A summary of your analysis.

### Merging some data :¶
With the data cleaned and prepared, the next step is to integrate the three datasets into a single unified table.We merge the datasets to create a unified table that combines the key information from daily_activity, daily_steps, and daily_sleep. This integration enables a comprehensive analysis by linking activity, step count, and sleep data for each user on a specific date. By merging these datasets, we can identify patterns, correlations, and trends across multiple aspects of users' behavior, which would not be possible if the data remained fragmented.

First, the daily_activity and daily_steps datasets are merged using the id and their respective date columns (activity_date and activity_day)..

Take a look :

```{r}
activity_steps_merged <- merge(daily_activity, daily_steps,
                               by.x = c("id", "activity_date"),
                               by.y = c("id", "activity_day"),
                               all = TRUE)
```

Next, the resulting merged dataset is combined with the daily_sleep dataset using the id and date columns (activity_date and sleep_day). This step integrates all three datasets into a unified table for analysis.

```{r}
merged_data<-merge(activity_steps_merged, sleep,
                   by.x=c("id","activity_date"),
                   by.y=c("id","sleep_day"),
                   all=TRUE)
```


- What's the relationship between steps taken in a day and sedentary minutes?
- How could this help inform the customer segments that we can market to?
- E.g. position this more as a way to get started in walking more?
- Or to measure steps that you're already taking?

## Step 5: Share

### Guiding questions

- **Were you able to answer the business questions?**
- **What story does your data tell?**
- **How do your findings relate to your original question?**
- **Who is your audience? What is the best way to communicate with them?**
- **Can data visualization help you share your findings?**
- **Is your presentation accessible to your audience?**

### Key tasks

1. Determine the best way to share your findings.
2. Create effective data visualizations.
3. Present your findings.
4. Ensure your work is accessible.

### Deliverable

Supporting visualizations and key findings.

### Follow these steps:

1. Take out a piece of paper and a pen and sketch some ideas for how you will visualize the data.
2. Once you choose a visual form, open your tool of choice to create your visualization. Use a presentation software, such as PowerPoint or Google Slides; your spreadsheet program; Tableau; or R.
3. Create your data visualization, remembering that contrast should be used to draw your audience’s attention to the most important insights. Use artistic principles including size, color, and shape.
4. Ensure clear meaning through the proper use of common elements, such as headlines, subtitles, and labels.
5. Refine your data visualization by applying deep attention to detail.

```{r}
ggplot(data=daily_activity, aes(x=total_steps, y=sedentary_minutes)) + geom_point() +
  geom_smooth() +
  labs(title="Total Steps vs. Sedentary Minutes")
```

- What's the relationship between minutes asleep and time in bed?
- You might expect it to be almost completely linear - are there any unexpected trends?

- The data shows a negative relationship between Steps and Sedentary time. This means that the more time someone spends sitting, the fewer steps they take during the day. The company should focus more on marketing to people with high Sedentary time and encourage them to start walking more and track their steps.

```{r}
ggplot(data=sleep, aes(x=total_minutes_asleep, y=total_time_in_bed)) + geom_point() +
  geom_smooth() +
  labs(title="Total Minutes Asleep vs. Total Time in Bed Minutes")
```

- What could these trends tell you about how to help market this product? Or areas where you might want to explore further?

- There is also a strong connection between Minutes Asleep and Time in Bed, with a nearly straight-line trend. To help users sleep better, the company could send reminders to go to sleep.

```{r}
ggplot(data=daily_activity, aes(x=total_steps, y=calories)) + geom_point() +
  geom_smooth() +
  labs(title="Total Steps vs. Calories Burned")
```


```{r}
ggplot(data=merged_data, aes(x=total_minutes_asleep, y=sedentary_minutes)) +
  geom_point(color='darkblue') + geom_smooth() +
  labs(title="Minutes Asleep vs. Sedentary Minutes")
```

- Here we can clearly see the negative relationship between Sedentary Minutes and Sleep time.
- As an idea: if Bellabeat users want to improve their sleep, Bellabeat app can recommend reducing sedentary time.
- Keep in mind that we need to support this insights with more data, because correlation between some data doesn’t mean causation.